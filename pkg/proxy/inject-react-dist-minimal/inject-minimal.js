var __defProp=Object.defineProperty,__defNormalProp=(e,o,t)=>o in e?__defProp(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,__publicField=(e,o,t)=>__defNormalProp(e,"symbol"!=typeof o?o+"":o,t);!function(){"use strict";function e(e){const o=e.type;return o?"string"==typeof o?o:o.displayName?o.displayName:o.name?o.name:"Anonymous":"Unknown"}"undefined"!=typeof window&&new class{constructor(){__publicField(this,"isSelectionMode",!1),__publicField(this,"isColorPickerMode",!1),__publicField(this,"hoveredElement",null),__publicField(this,"highlightOverlay",null),__publicField(this,"ws",null),__publicField(this,"reloadWs",null),__publicField(this,"reconnectAttempts",0),__publicField(this,"maxReconnectAttempts",5),__publicField(this,"pendingReload",!1),__publicField(this,"isProcessing",!1),this.init()}init(){console.log("[Layrr Minimal] Initializing..."),this.createHighlightOverlay(),this.connectWebSocket(),this.connectReloadWebSocket(),window.addEventListener("message",this.handleMessage.bind(this)),document.addEventListener("mousemove",this.handleMouseMove.bind(this),!0),document.addEventListener("click",this.handleClick.bind(this),!0),this.postMessage({type:"LAYRR_READY"}),console.log("[Layrr Minimal] Ready")}connectWebSocket(){try{const e=`ws://${window.location.host}/__layrr/ws/message`;console.log("[Layrr Minimal] Connecting to WebSocket:",e),this.ws=new WebSocket(e),this.ws.onopen=()=>{console.log("[Layrr Minimal] âœ… WebSocket connected"),this.reconnectAttempts=0,this.postMessage({type:"LAYRR_WS_CONNECTED"})},this.ws.onmessage=e=>{const o=JSON.parse(e.data);console.log("[Layrr Minimal] ðŸ“¨ Message from backend:",o),console.log("[Layrr Minimal] ðŸ“¨ Message status:",o.status),console.log("[Layrr Minimal] ðŸ“¨ Message id:",o.id),"received"===o.status?(this.isProcessing=!0,console.log("[Layrr Minimal] ðŸ”„ Processing started...")):"complete"!==o.status&&"error"!==o.status||(this.isProcessing=!1,console.log("[Layrr Minimal] âœ… Processing finished"),this.pendingReload&&(console.log("[Layrr Minimal] ðŸ”„ Executing pending reload..."),setTimeout(()=>{window.location.reload()},500)));const t={type:"MESSAGE_RESPONSE",payload:o};console.log("[Layrr Minimal] ðŸ“¤ Forwarding to parent window:",t),this.postMessage(t)},this.ws.onerror=e=>{console.error("[Layrr Minimal] âŒ WebSocket error:",e)},this.ws.onclose=()=>{if(console.log("[Layrr Minimal] ðŸ”Œ WebSocket disconnected"),this.postMessage({type:"LAYRR_WS_DISCONNECTED"}),this.reconnectAttempts<this.maxReconnectAttempts){const e=1e3*Math.pow(2,this.reconnectAttempts);console.log(`[Layrr Minimal] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts+1}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.reconnectAttempts++,this.connectWebSocket()},e)}}}catch(e){console.error("[Layrr Minimal] Failed to create WebSocket:",e)}}connectReloadWebSocket(){try{const e=`ws://${window.location.host}/__layrr/ws/reload`;console.log("[Layrr Minimal] Connecting to reload WebSocket:",e),this.reloadWs=new WebSocket(e),this.reloadWs.onopen=()=>{console.log("[Layrr Minimal] âœ… Reload WebSocket connected")},this.reloadWs.onmessage=e=>{"reload"===JSON.parse(e.data).type&&(this.isProcessing?(console.log("[Layrr Minimal] â³ Reload requested but processing in progress, will reload after completion..."),this.pendingReload=!0):(console.log("[Layrr Minimal] ðŸ”„ Reloading page due to file changes..."),window.location.reload()))},this.reloadWs.onerror=e=>{console.error("[Layrr Minimal] âŒ Reload WebSocket error:",e)},this.reloadWs.onclose=()=>{console.log("[Layrr Minimal] ðŸ”Œ Reload WebSocket closed")}}catch(e){console.error("[Layrr Minimal] Failed to create reload WebSocket:",e)}}createHighlightOverlay(){this.highlightOverlay=document.createElement("div"),this.highlightOverlay.id="layrr-highlight",this.highlightOverlay.style.cssText="\n      position: absolute;\n      pointer-events: none;\n      z-index: 2147483646;\n      border: 2px solid #a78bfa;\n      background: rgba(167, 139, 250, 0.1);\n      transition: all 0.15s ease-out;\n      display: none;\n    ",document.body.appendChild(this.highlightOverlay)}handleMessage(e){const{type:o,payload:t}=e.data;switch(o){case"ENABLE_SELECTION_MODE":this.enableSelectionMode();break;case"DISABLE_SELECTION_MODE":this.disableSelectionMode();break;case"ENABLE_COLOR_PICKER_MODE":this.enableColorPickerMode();break;case"DISABLE_COLOR_PICKER_MODE":this.disableColorPickerMode();break;case"HIGHLIGHT_ELEMENT":this.highlightElementBySelector(t.selector);break;case"SEND_ELEMENT_MESSAGE":case"SEND_VISION_MESSAGE":case"SEND_ATTACHMENT_MESSAGE":case"DIRECT_IMAGE_REPLACE":this.sendToWebSocket({type:o.toLowerCase().replace(/_/g,"-"),payload:t})}}sendToWebSocket(e){this.ws&&this.ws.readyState===WebSocket.OPEN?(console.log("[Layrr Minimal] ðŸ“¤ Sending to WebSocket:",e),this.ws.send(JSON.stringify(e))):(console.error("[Layrr Minimal] âŒ WebSocket not connected, cannot send message"),this.postMessage({type:"MESSAGE_RESPONSE",payload:{id:e.id,status:"error",error:"WebSocket not connected"}}))}enableSelectionMode(){this.isSelectionMode=!0,document.body.style.cursor="crosshair",console.log("[Layrr Minimal] Selection mode enabled")}disableSelectionMode(){this.isSelectionMode=!1,document.body.style.cursor="",this.hideHighlight(),console.log("[Layrr Minimal] Selection mode disabled")}enableColorPickerMode(){this.isColorPickerMode=!0,document.body.style.cursor="crosshair",console.log("[Layrr Minimal] Color picker mode enabled")}disableColorPickerMode(){this.isColorPickerMode=!1,document.body.style.cursor="",this.hideHighlight(),console.log("[Layrr Minimal] Color picker mode disabled")}handleMouseMove(e){if(!this.isSelectionMode&&!this.isColorPickerMode)return;const o=e.target;"layrr-highlight"!==o.id&&("layrr-container"===o.id||o.closest("#layrr-container")||o!==this.hoveredElement&&(this.hoveredElement=o,this.showHighlight(o)))}handleClick(e){if(!this.isSelectionMode&&!this.isColorPickerMode)return;e.preventDefault(),e.stopPropagation();const o=e.target;"layrr-highlight"!==o.id&&("layrr-container"===o.id||o.closest("#layrr-container")||(this.isColorPickerMode?this.pickColor(o):this.selectElement(o)))}selectElement(e){const o=this.getElementInfo(e);console.log("[Layrr Minimal] Element selected:",o),this.postMessage({type:"ELEMENT_SELECTED",payload:o}),this.disableSelectionMode()}pickColor(e){const o=window.getComputedStyle(e),t=o.backgroundColor,i=o.color,n=this.rgbToHex(t),s=this.rgbToHex(i);console.log("[Layrr Minimal] Color picked:",{backgroundColor:n,textColor:s}),this.postMessage({type:"COLOR_PICKED",payload:{backgroundColor:n,textColor:s,element:{tagName:e.tagName,selector:this.generateSelector(e)}}}),this.disableColorPickerMode()}rgbToHex(e){if(e.startsWith("#"))return e;if("transparent"===e||"rgba(0, 0, 0, 0)"===e)return"transparent";const o=e.match(/\d+/g);if(!o)return e;const[t,i,n]=o.map(Number);return"#"+[t,i,n].map(e=>{const o=e.toString(16);return 1===o.length?"0"+o:o}).join("")}generateSelector(e){const o=Array.from(e.classList),t=e.id;let i=e.tagName.toLowerCase();return t?i=`#${t}`:o.length>0&&(i+="."+o.join(".")),i}getElementInfo(o){const t=o.getBoundingClientRect(),i=Array.from(o.classList),n=o.id,s=o.tagName;let r=s.toLowerCase();if(n)r=`#${n}`;else if(i.length>0)r+="."+i.join(".");else{const e=o.parentElement;e&&(r+=`:nth-child(${Array.from(e.children).indexOf(o)+1})`)}const l=function(o){try{const t=function(e){const o=Object.keys(e).find(e=>e.startsWith("__reactFiber$")||e.startsWith("__reactInternalInstance$"));return o?e[o]:null}(o);if(!t)return console.log("[Layrr] No React Fiber found on element"),null;let i=t,n=0;const s=50;for(;i&&n<s;){if(i._debugSource){const{fileName:o,lineNumber:t,columnNumber:n}=i._debugSource,s=e(i);return console.log("[Layrr] Found component source via Fiber:",{fileName:o,lineNumber:t,componentName:s}),{fileName:o,lineNumber:t||0,columnNumber:n||0,componentName:s,method:"fiber"}}i=i.return,n++}return console.log("[Layrr] No _debugSource found in Fiber tree (React 19?)"),null}catch(t){return console.error("[Layrr] Error walking Fiber tree:",t),null}}(o);return{tagName:s,classes:i,id:n,selector:r,bounds:t.toJSON(),innerText:o.innerText,outerHTML:o.outerHTML,componentSource:l}}showHighlight(e){if(!this.highlightOverlay)return;const o=e.getBoundingClientRect();this.highlightOverlay.style.display="block",this.highlightOverlay.style.top=o.top+window.scrollY+"px",this.highlightOverlay.style.left=o.left+window.scrollX+"px",this.highlightOverlay.style.width=o.width+"px",this.highlightOverlay.style.height=o.height+"px"}hideHighlight(){this.highlightOverlay&&(this.highlightOverlay.style.display="none"),this.hoveredElement=null}highlightElementBySelector(e){try{const o=document.querySelector(e);o&&(this.showHighlight(o),o.scrollIntoView({behavior:"smooth",block:"center"}))}catch(o){console.error("[Layrr Minimal] Invalid selector:",e,o)}}postMessage(e){window.parent.postMessage(e,"*")}}}();

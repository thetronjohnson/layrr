var __defProp=Object.defineProperty,__defNormalProp=(e,t,o)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,__publicField=(e,t,o)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,o);!function(){"use strict";"undefined"!=typeof window&&new class{constructor(){__publicField(this,"isSelectionMode",!1),__publicField(this,"isColorPickerMode",!1),__publicField(this,"hoveredElement",null),__publicField(this,"highlightOverlay",null),__publicField(this,"ws",null),__publicField(this,"reconnectAttempts",0),__publicField(this,"maxReconnectAttempts",5),this.init()}init(){console.log("[Layrr Minimal] Initializing..."),this.createHighlightOverlay(),this.connectWebSocket(),window.addEventListener("message",this.handleMessage.bind(this)),document.addEventListener("mousemove",this.handleMouseMove.bind(this),!0),document.addEventListener("click",this.handleClick.bind(this),!0),this.postMessage({type:"LAYRR_READY"}),console.log("[Layrr Minimal] Ready")}connectWebSocket(){try{const e=`ws://${window.location.host}/__layrr/ws/message`;console.log("[Layrr Minimal] Connecting to WebSocket:",e),this.ws=new WebSocket(e),this.ws.onopen=()=>{console.log("[Layrr Minimal] âœ… WebSocket connected"),this.reconnectAttempts=0,this.postMessage({type:"LAYRR_WS_CONNECTED"})},this.ws.onmessage=e=>{const t=JSON.parse(e.data);console.log("[Layrr Minimal] ðŸ“¨ Message from backend:",t),this.postMessage({type:"MESSAGE_RESPONSE",payload:t})},this.ws.onerror=e=>{console.error("[Layrr Minimal] âŒ WebSocket error:",e)},this.ws.onclose=()=>{if(console.log("[Layrr Minimal] ðŸ”Œ WebSocket disconnected"),this.postMessage({type:"LAYRR_WS_DISCONNECTED"}),this.reconnectAttempts<this.maxReconnectAttempts){const e=1e3*Math.pow(2,this.reconnectAttempts);console.log(`[Layrr Minimal] Reconnecting in ${e}ms (attempt ${this.reconnectAttempts+1}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.reconnectAttempts++,this.connectWebSocket()},e)}}}catch(e){console.error("[Layrr Minimal] Failed to create WebSocket:",e)}}createHighlightOverlay(){this.highlightOverlay=document.createElement("div"),this.highlightOverlay.id="layrr-highlight",this.highlightOverlay.style.cssText="\n      position: absolute;\n      pointer-events: none;\n      z-index: 2147483646;\n      border: 2px solid #a78bfa;\n      background: rgba(167, 139, 250, 0.1);\n      transition: all 0.15s ease-out;\n      display: none;\n    ",document.body.appendChild(this.highlightOverlay)}handleMessage(e){const{type:t,payload:o}=e.data;switch(t){case"ENABLE_SELECTION_MODE":this.enableSelectionMode();break;case"DISABLE_SELECTION_MODE":this.disableSelectionMode();break;case"ENABLE_COLOR_PICKER_MODE":this.enableColorPickerMode();break;case"DISABLE_COLOR_PICKER_MODE":this.disableColorPickerMode();break;case"HIGHLIGHT_ELEMENT":this.highlightElementBySelector(o.selector);break;case"SEND_ELEMENT_MESSAGE":case"SEND_VISION_MESSAGE":this.sendToWebSocket(o)}}sendToWebSocket(e){this.ws&&this.ws.readyState===WebSocket.OPEN?(console.log("[Layrr Minimal] ðŸ“¤ Sending to WebSocket:",e),this.ws.send(JSON.stringify(e))):(console.error("[Layrr Minimal] âŒ WebSocket not connected, cannot send message"),this.postMessage({type:"MESSAGE_RESPONSE",payload:{id:e.id,status:"error",error:"WebSocket not connected"}}))}enableSelectionMode(){this.isSelectionMode=!0,document.body.style.cursor="crosshair",console.log("[Layrr Minimal] Selection mode enabled")}disableSelectionMode(){this.isSelectionMode=!1,document.body.style.cursor="",this.hideHighlight(),console.log("[Layrr Minimal] Selection mode disabled")}enableColorPickerMode(){this.isColorPickerMode=!0,document.body.style.cursor="crosshair",console.log("[Layrr Minimal] Color picker mode enabled")}disableColorPickerMode(){this.isColorPickerMode=!1,document.body.style.cursor="",this.hideHighlight(),console.log("[Layrr Minimal] Color picker mode disabled")}handleMouseMove(e){if(!this.isSelectionMode&&!this.isColorPickerMode)return;const t=e.target;"layrr-highlight"!==t.id&&("layrr-container"===t.id||t.closest("#layrr-container")||t!==this.hoveredElement&&(this.hoveredElement=t,this.showHighlight(t)))}handleClick(e){if(!this.isSelectionMode&&!this.isColorPickerMode)return;e.preventDefault(),e.stopPropagation();const t=e.target;"layrr-highlight"!==t.id&&("layrr-container"===t.id||t.closest("#layrr-container")||(this.isColorPickerMode?this.pickColor(t):this.selectElement(t)))}selectElement(e){const t=this.getElementInfo(e);console.log("[Layrr Minimal] Element selected:",t),this.postMessage({type:"ELEMENT_SELECTED",payload:t}),this.disableSelectionMode()}pickColor(e){const t=window.getComputedStyle(e),o=t.backgroundColor,i=t.color,s=this.rgbToHex(o),l=this.rgbToHex(i);console.log("[Layrr Minimal] Color picked:",{backgroundColor:s,textColor:l}),this.postMessage({type:"COLOR_PICKED",payload:{backgroundColor:s,textColor:l,element:{tagName:e.tagName,selector:this.generateSelector(e)}}}),this.disableColorPickerMode()}rgbToHex(e){if(e.startsWith("#"))return e;if("transparent"===e||"rgba(0, 0, 0, 0)"===e)return"transparent";const t=e.match(/\d+/g);if(!t)return e;const[o,i,s]=t.map(Number);return"#"+[o,i,s].map(e=>{const t=e.toString(16);return 1===t.length?"0"+t:t}).join("")}generateSelector(e){const t=Array.from(e.classList),o=e.id;let i=e.tagName.toLowerCase();return o?i=`#${o}`:t.length>0&&(i+="."+t.join(".")),i}getElementInfo(e){const t=e.getBoundingClientRect(),o=Array.from(e.classList),i=e.id,s=e.tagName;let l=s.toLowerCase();if(i)l=`#${i}`;else if(o.length>0)l+="."+o.join(".");else{const t=e.parentElement;t&&(l+=`:nth-child(${Array.from(t.children).indexOf(e)+1})`)}return{tagName:s,classes:o,id:i,selector:l,bounds:t.toJSON(),innerText:e.innerText,outerHTML:e.outerHTML}}showHighlight(e){if(!this.highlightOverlay)return;const t=e.getBoundingClientRect();this.highlightOverlay.style.display="block",this.highlightOverlay.style.top=t.top+window.scrollY+"px",this.highlightOverlay.style.left=t.left+window.scrollX+"px",this.highlightOverlay.style.width=t.width+"px",this.highlightOverlay.style.height=t.height+"px"}hideHighlight(){this.highlightOverlay&&(this.highlightOverlay.style.display="none"),this.hoveredElement=null}highlightElementBySelector(e){try{const t=document.querySelector(e);t&&(this.showHighlight(t),t.scrollIntoView({behavior:"smooth",block:"center"}))}catch(t){console.error("[Layrr Minimal] Invalid selector:",e,t)}}postMessage(e){window.parent.postMessage(e,"*")}}}();
